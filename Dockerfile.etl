FROM python:3.11-slim

RUN apt-get update && apt-get install -y \
    build-essential \
    curl \
    git \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Install dependencies
COPY pyproject.toml uv.lock ./
RUN pip install --no-cache-dir neo4j==5.14.1 pymongo retry python-dotenv

# Copy necessary code
COPY config/ ./config/
COPY neo4j_etl/ ./neo4j_etl/

ENV PYTHONPATH=/app
ENV PYTHONUNBUFFERED=1

CMD ["python", "neo4j_etl/src/dump_stackexchange_payload.py"]
